---
title: "RiskItemReport_Shiny"
output: 
html_document:
      theme:
      bootswatch: solar
date: "2023-09-29"
runtime: shiny

---

```{r echo=FALSE, message=FALSE, warning=FALSE, include=FALSE}
library(readr) 
library(magrittr) 
library(dplyr) 
library(kableExtra) 
library(rlang)
library(plotly)
library(ggplot2)
library(ggrepel)
library(dplyr)
library(crosstalk)
library(tidyverse)
library(leaflet)
library(DT)
library(shinythemes)
library(shiny)
erisk_item <- read_csv("C:/workspace/e-rarr/RiskItemReportShinyApp/data/RiskItem_FullView_Update.csv")
risk_item_db<-data.frame(erisk_item)
erisk_project <- read_csv("C:/workspace/e-rarr/RiskItemReportShinyApp/data/RiskProject_FullView.csv")
risk_project_db<-data.frame(erisk_project)
risk_treat <- read_csv("C:/workspace/e-rarr/RiskItemReportShinyApp/data/RiskTreatment_FullView.csv")
imagepath<-"C:/workspace/e-rarr/RiskItemReportShinyApp/images/check.png"



erisk_ItemProj<-left_join(risk_item_db, risk_project_db, by = "PROJECT_ID")

erisk_testing<-erisk_ItemProj[,c(3,4,5,6,8,22,27,32,40,51,56,64,65)]

RiskImpactTable<-erisk_ItemProj[,c(1,2,3,4,6,17,9,12,13,26,27,28,29,30,31,32,33,23,22,42,48,49,50,51,52)]
```

```{r , echo=FALSE }
shinyApp(
  ui = fluidPage(theme = shinytheme("darkly"),
    selectInput("projectInput", "Select a project", choices=c(RiskImpactTable$PROJECT_ID)),
    selectInput("riskInput", "Select a risk item", choices=c(RiskImpactTable$RISK_ID)),
    downloadButton("report", "Generate report")
  ),
  server = function(input, output) {
    output$report <- downloadHandler(
      # For PDF output, change this to "report.pdf"
      filename = "report.html",
      content = function(file) {
        # Copy the report file to a temporary directory before processing it, in
        # case we don't have write permissions to the current working dir (which
        # can happen when deployed).
        tempReport <- file.path(tempdir(), "RiskItemReport.Rmd")
        file.copy("RiskItemReport.Rmd", tempReport, overwrite = TRUE)

        # Set up parameters to pass to Rmd document
        params <- list( projID = input$projectInput, riskID= input$riskInput)

        # Knit the document, passing in the `params` list, and eval it in a
        # child of the global environment (this isolates the code in the document
        # from the code in this app).
        rmarkdown::render(tempReport, output_file = file,
          params = params,
          envir = new.env(parent = globalenv())
        )
      }
    )
  }
)
```



